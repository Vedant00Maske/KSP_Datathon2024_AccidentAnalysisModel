<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Team-VPY/sign-up</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="static/assets/VPY mainlogo.png"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
  </head>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap");

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }

    /* Reset some default styling */
    /* body, h1, h2, form, label, input, select {
        margin: 0;
        padding: 0;
        font-family: "Poppins", sans-serif;
    } */

    body {
      background: #3b3291;
      color: white;
      min-height: 100vh; /* Ensure gradient covers entire viewport height */
      display: flex;
      /* justify-content: center;
        align-items: center; */

      /* The image used */
      background-image: url("static/assets/bgimg.jpg");

      /* Full height */
      height: 100%;

      /* Center and scale the image nicely */
      background-position: center;
      background-repeat: no-repeat;
      background-size: cover;
    }

    .form-container .icons {
      position: absolute;
    }

    .logo {
      position: absolute;
      margin-left: 0%;
      height: 60px;
      width: auto;
      margin-top: 8px;
      padding-left: 0%;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 100px;
      padding: 0 5%;
      position: absolute;
      width: 100%;
      z-index: 100;
    }
    header h1 {
      margin-top: 25px;
      margin-left: 80px;
      font-size: 40px;
      color: white;
    }
    header nav {
      display: flex;
      gap: 30px;
    }
    header nav a {
      text-decoration: none;
      font-size: 20px;
      font-weight: 600;
      padding: 8px 16px;
      border-radius: 99px;
      transition: 0.3s;
      color: white;
    }
    header nav a.active {
      background: #5247b9;
    }
    header nav a:hover {
      background: #5247b9;
    }
    header nav:hover > a:not(:hover) {
      background: none;
    }

    .container1,
    .container2 {
      align-self: center;
      max-width: 1000px;
      padding: 20px;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px); /* Glass-like effect */
      margin-left: 10%;
      width: 50%;
    }

    h1,
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    form {
      display: flex;
      flex-direction: column;
    }

    label {
      font-weight: bold;
      margin-bottom: 10px;
    }

    select,
    input[type="text"],
    input[type="password"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin-bottom: 20px;
      background-color: rgba(255, 255, 255, 0.2);
      color: white;
    }

    [type="button"] {
      background-color: #7a2cc8;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 5px;
      cursor: pointer;
    }

    [type="button"]:hover {
      background-color: #802ee4;
    }
    option {
      background-color: #7a2cc8; /* Default background color for options */
      color: white; /* Default text color for options */
    }

    /* Style for selected option */
    option:checked {
      background-color: #802ee4; /* Selected option background color */
      color: #fff; /* Selected option text color */
    }

    .password {
      position: relative;
    }

    #password-input {
      padding-right: 20px; /* make room for the icon */
    }

    #toggle-password {
      position: absolute;
      right: 10px;
      top: 35%;
      transform: translateY(-50%);
      cursor: pointer;
    }

    main {
      margin-top: 10%;
      display: flex;
    }
    .container2 {
      width: 100%;
    }

    #error {
      color: red;
    }
  </style>
  <body>
    <header>
      <img src="static/assets/VPY mainlogo.png" class="logo" />
      <h1>Team VPY</h1>

      <nav>
        <a href="./" class="active">Home</a>
        <a href="./login">Log-in</a>
      </nav>
    </header>

    <br />
    <br />
    <main>
      <br /><br /><br /><br />
      <div class="container1">
        <h1>Create an account</h1>

        <form
          name="registration_form"
          id="registration_form"
          enctype="multipart/form-data"
          action="/signup"
          method="post"
        >
          <div class="row">
            <div class="col-sm-4">
              <div class="form-group">
                <label for="Name">Name</label>
                <br />
                <input
                  type="text"
                  name="name"
                  id="name"
                  class="form-control"
                  placeholder="Enter your name"
                />
              </div>
              <div class="form-group">
                <label for="id">Police-ID</label>
                <br />
                <input
                  type="text"
                  name="id"
                  id="id"
                  class="form-control"
                  placeholder="Enter your ID"
                />
              </div>
              <div class="form-group">
                <label for="email">Email</label>
                <br />
                <input
                  type="text"
                  name="email"
                  id="email"
                  class="form-control"
                  placeholder="Enter your email"
                />
              </div>
              <div class="form-group">
                <label for="password">Password</label>
                <br />
                <div class="password">
                  <input
                    type="password"
                    name="password"
                    id="password"
                    class="form-control"
                    placeholder="Enter Password"
                  />
                  <i id="toggle-password" class="fas fa-eye"></i>
                </div>

                <script>
                  var togglePassword =
                    document.querySelector("#toggle-password");
                  var passwordInput = document.querySelector("#password");

                  togglePassword.addEventListener("click", function (e) {
                    // toggle the type attribute
                    var type =
                      passwordInput.getAttribute("type") === "password"
                        ? "text"
                        : "password";
                    passwordInput.setAttribute("type", type);
                    // toggle the eye icon
                    this.classList.toggle("fa-eye-slash");
                  });
                </script>
              </div>
              <div class="form-group">
                <label for="confirm password">Confirm Password</label>
                <br />
                <input
                  type="password"
                  name="Confirm password"
                  id="Confirm password"
                  class="form-control"
                  placeholder="Confirm your password"
                />
              </div>
              <p id="error"></p>
              <button
                type="button"
                id="register"
                name="register"
                class="btn btn-success"
              >
                Register Now
              </button>
              <br /><br />
            </div>
            <p>Already have an account <a href="./login">Log-in</a></p>
          </div>
        </form>
      </div>

      <div class="container2">
        <h2>Instructions for Signing up:</h2>
        <ul>
          <li>
            Firstly put up the information needed i.e your Name, ID, E-Mail and
            Password.
          </li>
          <li>
            When you press on the Register now button you will be redirected to
            face recognition page.
          </li>
          <li>
            Fill in your E-Mail id and then Press on the Capture Face button,
            which will open up your camera for capturing your face.
          </li>
          <li>
            Keep your face steady while the camera captures your face. On the
            top left corner in the camera there will be a frame count.
          </li>
          <li>
            You will have to keep your face steady in front of the camera until
            the frame count reaches 100. Then press the done button.
          </li>
          <li>
            After you have submitted all your information you are good to sign
            in and continue.
          </li>
        </ul>
      </div>
    </main>

    <br />
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import {
        getAuth,
        createUserWithEmailAndPassword,
        sendEmailVerification,
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
      import {
        getFirestore,
        doc,
        setDoc,
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDwD37Q92VBM29BRL9ZmbO6Nw-X7DqPCi4",
        authDomain: "k-c-p-hackathon-0amrip.firebaseapp.com",
        projectId: "k-c-p-hackathon-0amrip",
        storageBucket: "k-c-p-hackathon-0amrip.appspot.com",
        messagingSenderId: "926202595834",
        appId: "1:926202595834:web:e3d00dcc60c1c381dc7c43",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      console.log("Firebase app initialized:", app);


        // New Registration code
        document
          .getElementById("register")
          .addEventListener("click", async function (event) {
            event.preventDefault();

            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            const name = document.getElementById("name").value;
            const id = document.getElementById("id").value;
            const cpassword = document.getElementById("Confirm password").value;

            if (password === cpassword) {
              try {
                const userCredential = await createUserWithEmailAndPassword(
                  auth,
                  email,
                  password
                );
                const user = userCredential.user;
                console.log("User registered:", user);

                // Send verification email
                await sendEmailVerification(user);
                console.log("Verification email sent to:", user.email);

                // Add user data to Firestore
                await setDoc(doc(db, "users", user.uid), {
                  email: user.email,
                  name: name,
                  id: id,
                  uid: user.uid,
                });
                console.log("User data added to Firestore:", user.uid);

                // Redirect to capture page
                window.location.href = "./capture";
              } catch (error) {
                const errorCode = error.code;
                const errorMessage = error.message;
                console.error("Registration error:", errorCode, errorMessage);

                // Display error message
                let error_msg = document.getElementById("error");
                error_msg.innerHTML = `Credentials already used`;
              }
            } else {
              let error_msg = document.getElementById("error");
              error_msg.innerHTML = `Password and Confirm Password do not match`;
            }
          });
      
    </script>
  </body>
</html>
